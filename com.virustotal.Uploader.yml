id: com.virustotal.Uploader
sdk: org.kde.Sdk
runtime: org.kde.Platform
runtime-version: "5.15"
command: VirusTotalUploader
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=host:ro
  - --share=network
cleanup:
  - "*.a"
  - "*.la"
  - /include
  - /lib/pkgconfig
modules:
  - name: jansson
    sources:
      - type: archive
        url: "https://github.com/akheron/jansson/archive/v2.13.1.tar.gz"
        sha256: f22901582138e3203959c9257cf83eba9929ac41d7be4a42557213a22ebcc7a0
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -ifv

  - name: c-vtapi
    sources:
      - type: git
        url: "https://github.com/VirusTotal/c-vtapi.git"
        commit: dae474e476de6e8b276604987212aa33102b9fbe
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -ifv

  - name: qt-virustotal-uploader
    buildsystem: qmake
    config-opts:
      - LIBS+=-L/app/lib
    post-install:
      - install -Dm755 VirusTotalUploader -t /app/bin
      - install -Dm644 vtlogo-sigma.png /app/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -Dm644 ${FLATPAK_ID}.desktop -t /app/share/applications
      - install -Dm644 ${FLATPAK_ID}.appdata.xml -t /app/share/appdata
    sources:
      - type: git
        url: "https://github.com/VirusTotal/qt-virustotal-uploader.git"
        commit: 7ee9b451fc2b97c6ce76ca4f2dc4dbe5b7fab784
      - type: file
        path: com.virustotal.Uploader.desktop
      - type: file
        path: com.virustotal.Uploader.appdata.xml
